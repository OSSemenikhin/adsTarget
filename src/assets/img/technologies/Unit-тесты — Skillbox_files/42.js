(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{"8BgZ":function(e,t,i){"use strict";i.d(t,"a",(function(){return q}));var s=i("EM62"),n=i("ruzS"),o=i("kXNc"),c=i("bxfK"),a=i("cdws"),r=i("cXTK"),d=i("QffU"),l=i("QQZH"),u=i("3p4X"),p=i("3mST"),m=i("Wg7D"),h=i("YtkY"),v=i("Ohay"),g=i("D57K"),f=i("yQYJ"),y=i("EMWv");class _{constructor(e){this.method=e.method,this.time=e.time,this.isFullscreen=e.isFullscreen,this.duration=e.duration,this.code=e.code}}var w=i("xzqx"),x=i("ZTXN"),T=i("C05f"),O=i("pBDD"),b=i("mW0F");class E{constructor(e){this.windowBoundaries=e}call(e,t){const i=new S(e),s=t.subscribe(i);return s.closed||i.add(Object(b.a)(i,this.windowBoundaries)),s}}class S extends O.a{constructor(e){super(e),this.window=new x.a,e.next(this.window)}notifyNext(e,t,i,s,n){this.openWindow()}notifyError(e,t){this._error(e)}notifyComplete(e){this._complete()}_next(e){this.window.next(e)}_error(e){this.window.error(e),this.destination.error(e)}_complete(){this.window.complete(),this.destination.complete()}_unsubscribe(){this.window=null}openWindow(){const e=this.window;e&&e.complete();const t=this.destination,i=this.window=new x.a;t.next(i)}}var C=i("xVbo"),M=i("w0kG"),I=i("wqq/"),P=i("B8NW"),k=i("lDeo"),L=i("RFPc");let F=(()=>{let e=class{constructor(e,t,i){this.videoPlayerActionsService=e,this.tutorialService=t,this.env=i,this.loadCounter=0,this.events$=new x.a,this.duration$=new T.a(null)}init(e){var t;this.events$.pipe((t=this.events$.pipe(Object(C.a)((e=>e.data.method===y.a.LOADED)),Object(w.b)(this)),function(e){return e.lift(new E(t))}),Object(w.b)(this)).subscribe((e=>{var t;const i=null===(t=Object(d.a)(this.tutorialService.topicItem$))||void 0===t?void 0:t.id;this.videoPlayerActionsService.setVideoEvents(e.pipe(Object(M.a)(this.tutorialService.topicItem$,this.tutorialService.tree$,this.duration$),Object(C.a)((([e,t,i,s])=>!!t.video_duration||!!s)),Object(h.a)((([e,t,i,s])=>({event:new _({method:e.data.method,time:e.data.time,isFullscreen:e.data.isFullscreen,duration:t.video_duration||s,code:e.data.code}),options:{topicItem:t,courseTree:i}}))),Object(I.a)({bufferSize:1,refCount:!0}),Object(P.a)((e=>e.options.topicItem.id===i))))})),e.onLoaded((e=>{this.loadCounter++;const t=this.createEvent(y.a.LOADED);this.events$.next(t),this.duration$.next(e)})),e.onPlay((e=>{const t=this.createEvent(y.a.PLAY,{time:e});this.events$.next(t)})),e.onPause((e=>{const t=this.createEvent(y.a.PAUSE,{time:e});this.events$.next(t)})),e.onTimeUpdated((e=>{const t=this.createEvent(y.a.TIME,{time:e});this.events$.next(t)})),e.onFullscreenChange((e=>{const t=this.createEvent(y.a.SET_VIDEO_FULLSCREEN,{isFullscreen:e});this.events$.next(t)}))}createEvent(e,t){var i;const s=new Event("player");return s.origin=this.env.get("playerUrl")[0],s.data={method:e,time:null==t?void 0:t.time,code:null===(i=this.loadCounter)||void 0===i?void 0:i.toString(10),isFullscreen:null==t?void 0:t.isFullscreen},s}};return e.\u0275fac=function(t){return new(t||e)(s.Oc(L.a),s.Oc(k.a),s.Oc(f.a))},e.\u0275prov=s.wc({token:e,factory:e.\u0275fac}),e=Object(g.b)([Object(w.a)()],e),e})();var j=i("RmUC"),$=i("po9k"),R=i("pcFS"),D=i("2kYt"),N=i("oWo4"),A=i("MfMy"),V=i("wN7T"),H=i("jR34");function W(e,t){if(1&e&&(s.Gc(0,"div",2),s.Gc(1,"span",3),s.Gd(2),s.Fc(),s.Gc(3,"span",4),s.Gd(4),s.Fc(),s.Fc()),2&e){const e=t.ngIf,i=s.Wc();s.nc(2),s.Hd(e.value),s.nc(1),s.sc("lesson-video-timecode__title--hhmmss-offset",e.withHours),s.nc(1),s.Hd(i.timecode.title)}}let G=(()=>{class e{constructor(e){this.viewportService=e,this.eyeIconName=A.svgIconEyeFilledV2.name}get isActive(){return!!this.active}ngOnInit(){this.time$=this.viewportService.isMobileViewport$.pipe(Object(h.a)((e=>{const{ts:t}=this.timecode;return e||t<N.c.SECONDS_IN_HOUR?{value:this.toMMSS(t),withHours:!1}:{value:this.toHHMMSS(t),withHours:!0}})))}toHHMMSS(e){const t=Math.floor(e/N.c.SECONDS_IN_HOUR),i=this.toMMSS(e-t*N.c.SECONDS_IN_HOUR);return`${this.pad(t)}:${i}`}toMMSS(e){const t=Math.floor(e/N.c.SECONDS_IN_MINUTE),i=e-t*N.c.SECONDS_IN_MINUTE;return`${this.pad(t)}:${this.pad(i)}`}pad(e){return e<10?`0${e}`:e}}return e.\u0275fac=function(t){return new(t||e)(s.Ac(V.a))},e.\u0275cmp=s.uc({type:e,selectors:[["app-lesson-video-timecode"]],hostVars:2,hostBindings:function(e,t){2&e&&s.sc("lesson-video-timecode--is-active",t.isActive)},inputs:{timecode:"timecode",active:"active"},decls:3,vars:4,consts:[["class","lesson-video-timecode__text-container",4,"ngIf"],[1,"lesson-video-timecode__eye-icon","small",3,"name"],[1,"lesson-video-timecode__text-container"],[1,"lesson-video-timecode__time"],[1,"lesson-video-timecode__title"]],template:function(e,t){1&e&&(s.Ed(0,W,5,4,"div",0),s.Xc(1,"async"),s.Bc(2,"svg-icon",1)),2&e&&(s.ed("ngIf",s.Yc(1,2,t.time$)),s.nc(2),s.ed("name",t.eyeIconName))},directives:[D.u,H.a],pipes:[D.b],styles:["[_nghost-%COMP%]{display:flex;align-items:center;position:relative;padding:11px 8px;border-radius:8px;cursor:pointer;transition:background-color 70ms ease-in-out}@media (min-width:1024px){[_nghost-%COMP%]{padding-top:10px;padding-right:12px;padding-bottom:10px}}@media (min-width:1280px){[_nghost-%COMP%]{padding-left:12px}}@media (min-width:1600px){[_nghost-%COMP%]{padding-top:8px;padding-bottom:8px}}[_nghost-%COMP%]:hover{background-color:var(--ui-sb-color-bg-secondary)}.lesson-video-timecode--is-active[_nghost-%COMP%]{background-color:var(--ui-sb-color-bg-secondary-accent)}@media (min-width:1024px){.lesson-video-timecode--is-active[_nghost-%COMP%]   .lesson-video-timecode__eye-icon[_ngcontent-%COMP%]{display:block}}.lesson-video-timecode__text-container[_ngcontent-%COMP%]{font-size:14px;line-height:18px;flex:1}@media (min-width:1024px){.lesson-video-timecode__text-container[_ngcontent-%COMP%]{font-size:16px;line-height:20px}}@media (min-width:1600px){.lesson-video-timecode__text-container[_ngcontent-%COMP%]{font-size:18px;line-height:24px}}.lesson-video-timecode__time[_ngcontent-%COMP%]{position:absolute;color:var(--ui-sb-color-text-secondary);text-decoration:underline}.lesson-video-timecode__title[_ngcontent-%COMP%]{overflow:hidden;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;padding-left:52px}@media (min-width:1024px){.lesson-video-timecode__title[_ngcontent-%COMP%]{padding-left:68px}}@media (min-width:768px){.lesson-video-timecode__title--hhmmss-offset[_ngcontent-%COMP%]{padding-left:75px}}@media (min-width:1024px){.lesson-video-timecode__title--hhmmss-offset[_ngcontent-%COMP%]{padding-left:89px}}@media (min-width:1600px){.lesson-video-timecode__title--hhmmss-offset[_ngcontent-%COMP%]{padding-left:98px}}.lesson-video-timecode__eye-icon[_ngcontent-%COMP%]{display:none;min-width:16px;margin-left:12px}"],changeDetection:0}),e})();function U(e,t){if(1&e){const e=s.Hc();s.Gc(0,"app-lesson-video-timecode",2),s.Sc("click",(function(){s.ud(e);const i=t.$implicit;return s.Wc().jumpToTimecode.emit(i.ts)})),s.Fc()}if(2&e){const e=t.$implicit,i=t.index,n=s.Wc();s.ed("timecode",e)("active",i===n.activeTimecodeIdx)}}let B=(()=>{class e{constructor(){this.jumpToTimecode=new s.t}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=s.uc({type:e,selectors:[["app-lesson-video-timecodes"]],inputs:{timecodes:"timecodes",activeTimecodeIdx:"activeTimecodeIdx"},outputs:{jumpToTimecode:"jumpToTimecode"},decls:3,vars:1,consts:[[1,"lesson-video-timecode__heading"],[3,"timecode","active","click",4,"ngFor","ngForOf"],[3,"timecode","active","click"]],template:function(e,t){1&e&&(s.Gc(0,"div",0),s.Gd(1,"\u0421\u043e\u0434\u0435\u0440\u0436\u0430\u043d\u0438\u0435 \u0432\u0438\u0434\u0435\u043e"),s.Fc(),s.Ed(2,U,1,2,"app-lesson-video-timecode",1)),2&e&&(s.nc(2),s.ed("ngForOf",t.timecodes))},directives:[D.t,G],styles:["[_nghost-%COMP%]{display:block}.lesson-video-timecode__heading[_ngcontent-%COMP%]{font-size:24px;line-height:36px;font-weight:600;margin-bottom:24px}@media (min-width:1600px){.lesson-video-timecode__heading[_ngcontent-%COMP%]{font-size:26px;line-height:39px;font-weight:600}}"],changeDetection:0}),e})();function z(e,t){if(1&e){const e=s.Hc();s.Gc(0,"app-lesson-video-timecodes",3),s.Sc("jumpToTimecode",(function(t){return s.ud(e),s.Wc(2).onJumpToTimecode(t)})),s.Xc(1,"async"),s.Fc()}if(2&e){const e=s.Wc(2);s.ed("timecodes",e.timecodes)("activeTimecodeIdx",s.Yc(1,2,e.activeTimecodeIdx$))}}function Q(e,t){if(1&e&&(s.Ec(0),s.Ed(1,z,2,4,"app-lesson-video-timecodes",2),s.Dc()),2&e){const e=s.Wc();s.nc(1),s.ed("ngIf",null==e.timecodes?null:e.timecodes.length)}}let q=(()=>{class e{constructor(e,t){this.lessonVideoPlayerService=e,this.logBus=t,this.trackable=!1,this.nextLesson=new s.t,this.saveWatchTime=new s.t,this.isFullscreen=new s.t,this.permission=n.yb.EnumValuesEnum,this.REPORT_INTERVAL=1e4,this.currentTime$=new l.a(1)}ngOnDestroy(){this.destroyIntervalReporterSub()}onInitialized(e){this.player=e,this.initLessonVideoPlayerService(),this.setupTimeUpdatesListener(),this.setupWatchTimeReporter(),this.setupTimecodeMatcher()}onQualityChange(e){this.logBus.log(new c.a({immediateDispatch:!0,message:new a.a({event_type:r.a.EventTypeEnum.set_video_quality,event_params:{quality:e,lesson_token:this.lessonToken}})}))}onRenderQualityChange(e){!e.oldValue||e.oldValue<e.newValue||this.logBus.log({name:r.a.EventTypeEnum.lesson_video_player_quality_dec,payload:{newQuality:e.newValue,oldQuality:e.oldValue?e.oldValue:"0",courseId:this.courseId,lesson_token:this.lessonToken},category:o.a.tech})}onSpeedChange(e){this.logBus.log(new c.a({immediateDispatch:!0,message:new a.a({event_type:r.a.EventTypeEnum.set_video_playback_speed,event_params:{speed:e,lesson_token:this.lessonToken}})}))}onJumpToTimecode(e){this.player.setCurrentTime({time:e,autoplay:!0})}initLessonVideoPlayerService(){this.trackable&&this.lessonVideoPlayerService.init(this.player)}setupTimeUpdatesListener(){this.player.onTimeUpdated((e=>this.currentTime$.next(e))),this.player.onPause((e=>this.currentTime$.next(e)))}setupWatchTimeReporter(){this.player.onPlay((()=>{this.intervalReporterSub=Object(u.a)(this.REPORT_INTERVAL).subscribe((()=>this.saveWatchTime.emit(Math.floor(Object(d.a)(this.currentTime$)))))})),this.player.onPause((e=>{this.saveWatchTime.emit(Math.floor(e)),this.destroyIntervalReporterSub()}))}destroyIntervalReporterSub(){this.intervalReporterSub&&this.intervalReporterSub.unsubscribe()}setupTimecodeMatcher(){if(this.timecodes){const e=[...this.timecodes];this.activeTimecodeIdx$=this.currentTime$.pipe(Object(p.a)(1),Object(m.a)(1e3),Object(h.a)((t=>{let i=null;for(let s=0;s<e.length&&t>=e[s].ts;s++)i=s;return i})),Object(v.a)())}}}return e.\u0275fac=function(t){return new(t||e)(s.Ac(F),s.Ac(j.a))},e.\u0275cmp=s.uc({type:e,selectors:[["app-lesson-video-player"]],inputs:{src:"src",nextLessonTitle:"nextLessonTitle",autoplay:"autoplay",startAt:"startAt",duration:"duration",lessonToken:"lessonToken",courseId:"courseId",fullscreen:"fullscreen",timecodes:"timecodes",trackable:"trackable"},outputs:{nextLesson:"nextLesson",saveWatchTime:"saveWatchTime",isFullscreen:"isFullscreen"},features:[s.mc([F])],decls:2,vars:7,consts:[[3,"src","nextLessonTitle","autoplay","fullscreen","startAt","duration","initialized","qualityChange","renderQualityChange","speedChange","nextLesson","isFullscreen"],[4,"appForPermission"],[3,"timecodes","activeTimecodeIdx","jumpToTimecode",4,"ngIf"],[3,"timecodes","activeTimecodeIdx","jumpToTimecode"]],template:function(e,t){1&e&&(s.Gc(0,"app-sb-video-player-wrapper",0),s.Sc("initialized",(function(e){return t.onInitialized(e)}))("qualityChange",(function(e){return t.onQualityChange(e)}))("renderQualityChange",(function(e){return t.onRenderQualityChange(e)}))("speedChange",(function(e){return t.onSpeedChange(e)}))("nextLesson",(function(){return t.nextLesson.emit()}))("isFullscreen",(function(e){return t.isFullscreen.emit(e)})),s.Fc(),s.Ed(1,Q,2,1,"ng-container",1)),2&e&&(s.ed("src",t.src)("nextLessonTitle",t.nextLessonTitle)("autoplay",t.autoplay)("fullscreen",t.fullscreen)("startAt",t.startAt)("duration",t.duration),s.nc(1),s.ed("appForPermission",t.permission.CAN_ACCESS_VIDEO_TIMECODES_WITHIN_CLIENT_CUSTOM))},directives:[$.a,R.a,D.u,B],pipes:[D.b],styles:["[_nghost-%COMP%]{display:block}app-lesson-video-timecodes[_ngcontent-%COMP%]{width:100%;margin-top:40px}@media (min-width:1024px){app-lesson-video-timecodes[_ngcontent-%COMP%]{margin-top:64px}}@media (min-width:1280px){app-lesson-video-timecodes[_ngcontent-%COMP%]{width:768px;margin-right:auto;margin-left:auto}}@media (min-width:1600px){app-lesson-video-timecodes[_ngcontent-%COMP%]{width:1024px;margin-top:80px}}"],changeDetection:0}),e})()},KJ42:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var s=i("2kYt"),n=i("OZ4H"),o=i("5h/E"),c=i("EM62");let a=(()=>{class e{}return e.\u0275mod=c.yc({type:e}),e.\u0275inj=c.xc({factory:function(t){return new(t||e)},imports:[[s.c,o.Db,n.g]]}),e})()},ap39:function(e,t,i){"use strict";i.d(t,"a",(function(){return u}));var s=i("2kYt"),n=i("jIDP"),o=i("0WSv"),c=i("/Ffh"),a=i("MfMy"),r=i("EM62");let d=(()=>{class e{constructor(e){e.registerIcons([a.svgIconEyeFilledV2])}}return e.\u0275mod=r.yc({type:e}),e.\u0275inj=r.xc({factory:function(t){return new(t||e)(r.Oc(c.b))},imports:[[s.c,c.a]]}),e})(),l=(()=>{class e{}return e.\u0275mod=r.yc({type:e}),e.\u0275inj=r.xc({factory:function(t){return new(t||e)},imports:[[s.c,d]]}),e})(),u=(()=>{class e{}return e.\u0275mod=r.yc({type:e}),e.\u0275inj=r.xc({factory:function(t){return new(t||e)},imports:[[s.c,n.a,l,o.a]]}),e})()},oXWE:function(e,t,i){"use strict";i.d(t,"a",(function(){return y}));var s=i("ruzS"),n=i("ABPI"),o=i("QffU"),c=i("ROBh"),a=i("xVbo"),r=i("J+dc"),d=i("TLy2"),l=i("XMum"),u=i("Uyy+"),p=i("EM62"),m=i("lzje"),h=i("QBoQ"),v=i("sEIs"),g=i("5h/E"),f=i("Jzyt");let y=(()=>{class e{constructor(e,t,i,s,n,o,c,a){this.studentsVideosService=e,this.studentsHomeworksService=t,this.studentsTestsService=i,this.permissionsFacade=s,this.coursesFacade=n,this.router=o,this.toastr=c,this.translocoService=a}resolve(e){const{courseSlug:t,token:i}=n.a.reduceSnapshot(e),s=Object(o.a)(this.coursesFacade.selectCourseTreeBySlug(t));return this.permissionsFacade.removePermissionByLessonId(i),this.permissionsFacade.checkLessons(null==s?void 0:s.id,[i]),this.permissionsFacade.selectByLessonId(i).pipe(Object(a.a)((e=>!!e)),Object(r.a)(1),Object(d.a)((s=>this.getTutorial(e.data.type,i,t,s))))}getTutorial(e,t,i,n){if(n.access_token)switch(e){case s.ob.LessonTypeEnum.VIDEOLESSON:return this.studentsVideosService.v3StudentsVideosRead({id:t,xLATOKEN:n.access_token});case s.ob.LessonTypeEnum.HOMEWORK:return this.studentsHomeworksService.v3StudentsHomeworksRead({id:t,xLATOKEN:n.access_token});case s.ob.LessonTypeEnum.TEST:return this.studentsTestsService.v3StudentsTestsRead({id:t,xLATOKEN:n.access_token});case s.ob.LessonTypeEnum.LONGREAD:return Object(c.a)({token:t,courseSlug:i,lessonCheck:n});default:throw new Error("[TutorialResolver]: invalid value assigned to 'type' variable")}if(n.access_level===s.v.AccessLevelEnum.NONE)throw this.toastr.error(this.translocoService.translate("toastMessages.lessonAccess")),this.navigateToCourseDetail(i),new Error(`[TutorialResolver]: try navigate to ${e} ${t} with access_level = "${n.access_level}"`);throw this.toastr.error(this.translocoService.translate("toastMessages.accessError")),this.navigateToCourseDetail(i),new Error(`[TutorialResolver]: no access_token for ${e} ${t} with access_level = "${n.access_level}"`)}navigateToCourseDetail(e){this.router.navigate(["/",l.a.EDUCATION,u.a.COURSE,e])}}return e.\u0275fac=function(t){return new(t||e)(p.Oc(s.Kf),p.Oc(s.Df),p.Oc(s.Jf),p.Oc(m.a),p.Oc(h.a),p.Oc(v.f),p.Oc(g.ac),p.Oc(f.h))},e.\u0275prov=p.wc({token:e,factory:e.\u0275fac}),e})()},sHnX:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var s=i("EM62"),n=i("5h/E");let o=(()=>{class e{constructor(e,t){this.elementRef=e,this.galleryService=t,this.openedGallery=new s.t}imageGallery(e){e.target instanceof HTMLImageElement&&(this.galleryService.openGallery(this.imagesPath,this.imagesPath.indexOf(e.target.src)),this.openedGallery.emit())}onMouseEnter(e){e.target instanceof HTMLImageElement&&(e.target.style.cursor="pointer")}ngOnInit(){this.images=Array.from(this.elementRef.nativeElement.querySelectorAll("img")),this.imagesPath=this.images.map((e=>e.src))}}return e.\u0275fac=function(t){return new(t||e)(s.Ac(s.q),s.Ac(n.Eb))},e.\u0275dir=s.vc({type:e,selectors:[["","appGalleryElements",""]],hostBindings:function(e,t){1&e&&s.Sc("click",(function(e){return t.imageGallery(e)}))("mouseover",(function(e){return t.onMouseEnter(e)}))},outputs:{openedGallery:"openedGallery"}}),e})()}}]);